<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Precios Cripto en Vivo</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body{font-family:Arial;background:#111;color:#fff;text-align:center;padding:30px;}
  h1{color:#ffcc00;margin-bottom:25px;}
  table{width:90%;max-width:700px;margin:auto;border-collapse:collapse;background:#1b1b1b;border-radius:10px;overflow:hidden;}
  th{background:#ffcc00;color:#111;padding:12px;}
  td{padding:10px 15px;}
  tr:nth-child(even){background:#222;} tr:hover{background:#333;}
  .coin{color:#ffcc00;font-weight:bold;cursor:pointer;}
  #chart{max-width:700px;margin:30px auto;padding:15px;background:#1b1b1b;border-radius:10px;display:none;}
  select{background:#222;color:#ffcc00;border:1px solid #ffcc00;border-radius:5px;padding:4px;margin-bottom:8px;}
</style>
</head>
<body>
<h1>Precios Cripto (USD)</h1>
<table id="tabla">
  <tr><th>Criptomoneda</th><th>Precio</th></tr>
  <tr data-coin="bitcoin"><td class="coin">Bitcoin (BTC)</td><td id="btc">Cargando…</td></tr>
  <tr data-coin="ethereum"><td class="coin">Ethereum (ETH)</td><td id="eth">Cargando…</td></tr>
  <tr data-coin="solana"><td class="coin">Solana (SOL)</td><td id="sol">Cargando…</td></tr>
</table>
<p id="hora"></p>
<div id="chart">
  <h3 id="titulo"></h3>
  <select id="rango">
    <option value="1">1 día</option>
    <option value="7" selected>7 días</option>
    <option value="30">30 días</option>
    <option value="365">1 año</option>
  </select>
  <canvas id="grafico"></canvas>
</div>

<script>
async function precios(){
  try{
    let r=await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana&vs_currencies=usd");
    let d=await r.json();
    btc.textContent=`$${d.bitcoin.usd.toLocaleString()}`;
    eth.textContent=`$${d.ethereum.usd.toLocaleString()}`;
    sol.textContent=`$${d.solana.usd.toLocaleString()}`;
    hora.textContent="Última actualización: "+new Date().toLocaleTimeString();
  }catch(e){hora.textContent="Error al obtener precios";}
}
async function grafico(moneda,nombre){
  chart.style.display="block"; titulo.textContent=`Histórico de ${nombre}`;
  let dias=rango.value;
  let r=await fetch(`https://api.coingecko.com/api/v3/coins/${moneda}/market_chart?vs_currency=usd&days=${dias}`);
  let d=await r.json();
  let puntos=d.prices.map(p=>({x:new Date(p[0]),y:p[1]}));
  if(window.graf)window.graf.destroy();
  window.graf=new Chart(grafico.getContext("2d"),{
    type:"line",
    data:{datasets:[{label:"USD",data:puntos,borderColor:"#ffcc00",backgroundColor:"rgba(255,204,0,0.2)",fill:true,tension:.3}]},
    options:{scales:{x:{type:"time",time:{unit:dias>30?"month":"day"},ticks:{color:"#fff"},grid:{color:"#333"}},
                     y:{ticks:{color:"#fff"},grid:{color:"#333"}}},
             plugins:{legend:{labels:{color:"#fff"}}}}
  });
}
tabla.onclick=e=>{
  let fila=e.target.closest("tr[data-coin]");
  if(fila){grafico(fila.dataset.coin,fila.children[0].textContent);}
};
rango.onchange=()=>{if(window.graf)grafico(window.graf.config.data.datasets[0].label.split(" ")[1],titulo.textContent)};
precios(); setInterval(precios,300000);
</script>
</body>
</html>
